<ion-header>
  <ion-toolbar color="primary" style="border: 3px white solid; border-radius: 15px 15px 0 0;">
    <ion-grid fixed>

      <ion-row style="padding: 10px 10px; height: 80px;">

        <ion-col size="2" style="display: flex; padding: 0px 5px 0px 0px;">
          <ion-avatar style="--border-radius:20px; margin: 0 auto; border: 2px #ffffffc0 solid;">
            <img src="assets/icon/person.png" />
          </ion-avatar>
        </ion-col>
        
        <ion-col size="10" style="display: inline-flex;">
          <span style="display: inline-grid;">
            <ion-label style="font-size: 1.9rem; margin-bottom: 1rem;">CERTICADO DE APTITUD</ion-label>
            <ion-label style="margin: auto 0px; text-overflow: ellipsis; white-space: nowrap;
                  overflow: hidden !important; font-size: 1.1rem; font-weight: 500;">
              {{aspirante.asp_nombre}}
            </ion-label>
          </span>
        </ion-col>
      </ion-row>


      <ion-row style="border-top: 2px #ffffff90 solid; margin-top: 5px; padding: 5px 1rem;">

        <ion-col size="6">
          <span style="display: inline-grid;">
            <ion-label style="font-size: 0.8rem;">
              <ion-icon name="business-outline"> </ion-icon>
              PROMINE
            </ion-label>
            <ion-label style="font-size: 0.8rem;">
              <ion-icon name="heart-circle"> </ion-icon>
              DEPARTAMENTO MEDICO PROMINE
            </ion-label>
            <ion-label style="font-size: 0.8rem;">
              <ion-icon name="id-card-outline"> </ion-icon>
              N° Historia Clinica: {{aspirante.asp_cedula}}
            </ion-label>
            <ion-label style="font-size: 0.8rem;">
              <ion-icon name="ribbon-outline"> </ion-icon>
              Cargo: <i>{{aspirante.asp_cargo}}</i>
            </ion-label>
          </span>
        </ion-col>

        <ion-col size="6">
          <span style="display: inline-grid;">
            <ion-label style="font-size: 0.8rem;">
              <ion-icon name="information-circle"> </ion-icon>
              RUC: 0791722772001
            </ion-label>
            <ion-label style="font-size: 0.8rem;">
              <ion-icon name="finger-print"> </ion-icon>
              CIIU: <i> B072 </i>
            </ion-label>
            <ion-label style="font-size: 0.8rem;">
              <ion-icon name="male-female-outline"> </ion-icon>
              Sexo: <i> {{aspirante.asp_sexo}} </i>
            </ion-label>
            <!-- <ion-label style="font-size: 0.8rem;">
              <ion-icon name="hourglass"> </ion-icon>
              Edad: <i> {{asp_edad}} años </i>
            </ion-label> -->
            <ion-label style="font-size: 0.8rem;">
              <ion-icon name="id-card-outline"> </ion-icon>
              N° Archivo: {{aspirante.asp_cedula}}
            </ion-label>
          </span>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content class="" color="light" style="">

  <!-- <ion-card> -->

  <swiper #swiper [allowTouchMove]="false">

    <ng-template swiperSlide class="swiper-medicina">
      <ion-card>

        <ion-card-header>
          <ion-card-title class="ion-text-center" color="primary">DATOS GENERALES</ion-card-title>
        </ion-card-header>

        <ion-card-content>
          <ion-row>

            <ion-col size="7">
              <ion-item [disabled]="aspirante.amv_verificado" fill="outline">

                <ion-label color="primary" class="text-small" style="margin:8px;">Fecha de emision: <br>
                  {{aspirante.amv_femision}}</ion-label>
                <ion-buttons>
                  <ion-button id="open-emision" (click)="abrirModalfecha('mdFechaEmision')">
                    <ion-icon name="calendar-outline" color="primary"></ion-icon>
                  </ion-button>
                  <ion-modal [isOpen]="mdFechaEmision">
                    <ng-template>
                      <ion-content class="ion-padding">
                        <ion-datetime [value]="fechaEmision.toISOString()" locale="es-ES" showDefaultTimeLabel="false"
                          name="fechaEmision" (ionChange)="setFecha($event)" size="cover" mode="md"
                          showDefaultButtons="true" doneText="Aceptar" cancelText="Cancelar">
                          <span slot="title">INGRESO DE ENTREVISTA</span>
                          <span slot="time-label">Hora de entrevista</span>
                        </ion-datetime>
                      </ion-content>
                    </ng-template>
                  </ion-modal>
                </ion-buttons>
              </ion-item>
            </ion-col>

            <ion-col size="5">
              <ion-item [disabled]="aspirante.amv_verificado" fill="outline">
                <ion-label position="floating" style="margin-top: 0px;"> Evaluacion medica:</ion-label>
                <ion-select mode="ios" placeholder="Evaluacion medica" interface="popover"
                  [(ngModel)]="aspirante.amv_evaluacion" name="evaluacionAspirante" 
                  [selectedText]="aspirante.amv_evaluacion"> 
                  <ion-select-option *ngFor="let item of evaluacion">{{item.asp_nombre}}</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>

          </ion-row>
        </ion-card-content>

        <ion-card-header>
          <ion-card-title class="ion-text-center" color="primary">APTITUD MÉDICA LABORAL</ion-card-title>
          <ion-card-subtitle color="primary"> <b>Después de la valoración médica ocupacional se certifica que la persona en mención, es
            calificada como:</b> 
          </ion-card-subtitle>
        </ion-card-header>

        <ion-card-content>
          <ion-row>

            <ion-col size="12">
              <ion-item [disabled]="aspirante.amv_verificado" fill="outline">
                <ion-label position="floating" color="primary">Valoracion medica</ion-label>
                <ion-select mode="ios" placeholder="Seleccione una" interface="popover"
                  [(ngModel)]="aspirante.amv_valoracion" name="valoracionAspirante"
                  [selectedText]="aspirante.amv_valoracion" (ionChange)="validarSlide1()" > 
                  <ion-select-option *ngFor="let item of valoracion">{{item.asp_nombre}}</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>

            <ion-col size="12">
              <ion-item [hidden]="" [disabled]="aspirante.amv_verificado" fill="outline">
                <ion-label position="floating" color="primary">Detalle de observaciones</ion-label>
                <ion-textarea [(ngModel)]="aspirante.amv_observacion" [value]="aspirante.apv_observacion" type="text"
                  name="apv_observacion" placeholder="Detalle de observaciones" rows="4" 
                  (ionChange)="editTextbox($event,'amv_observacion')" [autoGrow]="false">
                </ion-textarea>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-card-content>

      </ion-card>
    </ng-template>

    <ng-template swiperSlide class="swiper-medicina">
      <ion-card>

        <ion-card-header>
          <ion-card-title class="ion-text-center" color="primary">CONDICIONES DE SALUD AL MOMENTO DEL RETIRO
          </ion-card-title>
          <ion-card-subtitle>Después de la valoración médica ocupacional se certifica las condiciones de salud al
            momento del retiro:
          </ion-card-subtitle>
        </ion-card-header>

        <ion-card-content>
          <ion-row>

            <ion-col size="12">
              <ion-item [disabled]="aspirante.amv_verificado" fill="outline">
                <ion-label position="floating" color="primary">Condicion medica</ion-label>
                <ion-select mode="ios" placeholder="Seleccione una" interface="popover"
                  [(ngModel)]="aspirante.amv_condicion" name="condicionAspirante"
                  [selectedText]="aspirante.amv_condicion" (ionChange)="validarSlide2()" >
                  <ion-select-option *ngFor="let item of condicion">{{item.asp_nombre}}</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>

            <ion-col size="12">
              <ion-item [hidden]="" [disabled]="aspirante.amv_verificado" fill="outline">
                <ion-label position="floating" color="primary" >Observaciones relacionadas con las condicones de salud
                </ion-label>
                <ion-textarea class="custom-textarea" [(ngModel)]="aspirante.amv_observacion2"
                  [value]="aspirante.amv_observacion2" type="text" name="amv_observacion" rows="2" 
                  placeholder="Observaciones relacionadas con las condicones de salud al momento del retiro"
                  (ionChange)="editTextbox($event,'amv_observacion2')" [autoGrow]="false">
                </ion-textarea>
              </ion-item>
            </ion-col>

            <ion-col size="12">
              <ion-item [hidden]="" [disabled]="aspirante.amv_verificado" lines="full" fill="outline">
                <ion-label position="floating" color="primary" >Tratamiento y recomendaciones</ion-label>
                <ion-textarea class="custom-textarea" [(ngModel)]="aspirante.amv_recomendacion"
                  [value]="aspirante.amv_recomendacion" type="text" name="amv_concepto" rows="2" 
                  placeholder="Tratamiento y recomendaciones" (ionChange)="editTextbox($event,'amv_recomendacion')"
                  [autoGrow]="false">
                </ion-textarea>
              </ion-item>
            </ion-col>

          </ion-row>
        </ion-card-content>

        <!-- <ion-item color="primary">
          <ion-icon slot="start" name="pin-outline"></ion-icon>
          <ion-label>La presente certificación se expide con base en la historia ocupacional del usuario (a), la cual tiene carácter de confidencial</ion-label>
        </ion-item> -->

        <ion-card-content style="background: #e3990f5e; color:var(--ion-color-primary);">
          Con este documento certifico que el trabajador se ha sometido a la evaluación médica requerida para (el
          ingreso/ la ejecución/ el reintegro y retiro) al puesto laboral y se ha informado sobre los riesgos
          relacionados con el trabajo emitiendo recomendaciones relacionadas con su estado de salud.
        </ion-card-content>

      </ion-card>
    </ng-template>

    <ng-template swiperSlide class="swiper-medicina">
      <ion-card>

        <ion-card-header>
          <ion-card-title class="ion-text-center" color="primary">SUBIR O DESCARGAR DOCUMENTOS</ion-card-title>
        </ion-card-header>
        <ion-card-content>

          <ion-button (click)="generarHistoriaClinica()" expand="block" fill="solid" shape="round" 
                  [hidden]="aspirante.amv_verificado == true || rol != 'medi'" style="margin: 0 5%;">
            <ion-icon slot="start" name="document-attach"></ion-icon>
            Generar Historia clinica
          </ion-button>

          <div style="margin-bottom: 1rem; text-align: left;" class="ion-padding">

            <ion-label>archivo de Historia clinica</ion-label>

            <ion-item [hidden]="aspirante.amv_verificado == true || rol != 'medi' || subiendoHistoria" class="item-file"
              [style.--background]="(existeHistoria)?'var(--ion-color-success)':'#ffffff'"
              [style.opacity]="(existeHistoria)?0.9:1">

              <ion-input (change)="fileChange($event,0)" type="file" accept=".xls,.xlsx,.pdf" [disabled]="subiendoHistoria"
                style="position: absolute; font-size: 0.9rem;" [hidden]="subiendoHistoria"
                [color]="(subiendoHistoria)?'medium':'primary'">
              </ion-input>
              <ion-icon slot="end" name="checkmark-circle" size="large" color="primary" [hidden]="!existeHistoria"
                style="margin: 0;"></ion-icon>

            </ion-item>

            <div [hidden]="!subiendoHistoria"
              style="display:flex; align-items: center; justify-content: right; font-size: 1rem;">
              <ion-skeleton-text animated class="subir-skeleton"> </ion-skeleton-text>
              <ion-label class="subir-label"> ...subiendo historia clinica
                <ion-spinner name="crescent" color="success" style="margin-right:10px; margin-left:10px;">
                </ion-spinner>
              </ion-label>
            </div>

            <ion-button [hidden]="aspirante.amv_verificado != true || rol != 'medi' || !aspirante.amv_urlhistoria"
              [href]="(!!aspirante.amv_urlhistoria)?aspirante.amv_urlhistoria.replace('..','https://getssoma.com') : ''"
              expand="block" fill="outline" shape="round" color="warning" target="_blank">
              <ion-label color="primary">
                Descargar Historia clinica
                <ion-icon name="download-outline" slot="end"></ion-icon>
              </ion-label>
            </ion-button>
          </div>
          
          <div style="margin-bottom: 1rem; text-align: left;" class="ion-padding">

            <ion-label >archivo de Ficha medica</ion-label>

            <ion-item [hidden]="aspirante.amv_verificado == true || rol != 'medi' || subiendoFicha" class="item-file"
              [style.--background]="(existeFicha)?'var(--ion-color-success)':'#ffffff'"
              [style.opacity]="(existeFicha)?0.9:1">
              <ion-input (change)="fileChange($event,1)" type="file" accept=".xls,.xlsx,.pdf" [disabled]="subiendoFicha"
                style="position: absolute; font-size: 0.9rem;" [hidden]="subiendoFicha"
                [color]="(subiendoFicha)?'medium':'primary'">
              </ion-input>
              <ion-icon slot="end" name="checkmark-circle" size="large" color="primary" [hidden]="!existeFicha"
                style="margin: 0;"></ion-icon>

            </ion-item>

            <div [hidden]="!subiendoFicha"
              style="display:flex; align-items: center; justify-content: right; font-size: 1rem;">
              <ion-skeleton-text animated class="subir-skeleton"> </ion-skeleton-text>
              <ion-label class="subir-label"> ...subiendo ficha medica
                <ion-spinner name="crescent" color="success" style="margin-right:10px; margin-left:10px;">
                </ion-spinner>
              </ion-label>
            </div>

            <ion-button [hidden]="aspirante.amv_verificado != true || rol != 'medi' || !aspirante.amv_urlficha"
              [href]="(!!aspirante.amv_urlficha)?aspirante.amv_urlficha.replace('..','https://getssoma.com') : ''"
              expand="block" fill="outline" shape="round" color="warning" target="_blank">
              <ion-label color="primary">
                Descargar Ficha medica
                <ion-icon name="download-outline" slot="end"></ion-icon>
              </ion-label>
            </ion-button>
          </div>
        </ion-card-content>

      </ion-card>
    </ng-template>
  </swiper>
</ion-content>

<ion-footer class="ion-padding" [translucent]="true" mode="md">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="cerrarModal()" fill="outline" color="danger" >
        Cancelar
      </ion-button>
    </ion-buttons>

    <ion-buttons slot="end">
        <div style="display: inline-flex;" slot="secondary">
          <ion-fab-button size="small" (click)="setSlide(0)" [color]="(selectSlide==0)?'warning':'light'">
            <ion-text color="primary">
              <b>1</b>
            </ion-text>
          </ion-fab-button>
          <ion-fab-button size="small" (click)="setSlide(1)" [color]="(selectSlide==1)?'warning':'light'">
            <ion-text color="primary">
              <b>2</b>
            </ion-text>
          </ion-fab-button>
          <ion-fab-button size="small" (click)="setSlide(2)" [color]="(selectSlide==2)?'warning':'light'">
            <ion-text color="primary">
              <b>3</b>
            </ion-text>
          </ion-fab-button>
        </div>
    </ion-buttons>

    <ion-buttons slot="end">
      <ion-button [disabled]="(!validado1 && selectSlide==0) || (!validado2 && selectSlide==1) || (aspirante.amv_verificado==true && selectSlide==2)" 
                  (click)="presentAlert()" style="margin:0 20px;" expand="block" fill="solid" color="primary" slot="end">
        <ion-label>{{(selectSlide==2)?'Finalizar':'Siguiente'}}</ion-label>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>